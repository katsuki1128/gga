<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport"
    content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no">


  <title>startup_kyushu</title>

  <!-- CSS & Tailwind -->
  <!-- <link rel="stylesheet" href="css/reset.css" /> -->
  <link rel="stylesheet" href="css/style.css" />
  <script src="https://cdn.tailwindcss.com"></script>

</head>

<body>
  <!----------------------------------------------
    â­ï¸ã‚¿ã‚¤ãƒˆãƒ«
    ------------------------------------------------->
  <section>
    <div class="flex flex-col items-center justify-center px-2 py-2">
      <div class="canvas-wrapper relative">
        <img src="img/bg.png" class="rounded-lg">

        <a href="stamp_create.html" class="absolute top-4 left-4">
          <img src="img/startup_kyushu_logo.png" class="w-1/2 mr-2" />
        </a>

        <canvas id="overlay"></canvas>

        <div class="absolute bottom-2 left-4 text-container">
          <div class="text-lg font-bold m-0 text-white truncate">
            ã¿ã‚“ãªã§æŠ¼ã—ã¦ãƒ”ãƒƒãƒã‚’å¿œæ´ã—ã‚ˆã†ï¼
          </div>
          <div class="text-sm m-0 text-white truncate">
            ãƒ”ãƒƒãƒçµ‚äº†å¾Œã€æ°—ã«ãªã‚‹ç™»å£‡è€…ã¸ãŠæ°—è»½ã«ãŠå£°ãŒã‘ãã ã•ã„â™ª
          </div>
        </div>
      </div>
    </div>
  </section>
  <!----------------------------------------------
    â­ï¸ã‚¹ã‚¿ãƒ³ãƒ—è¡¨ç¤ºã‚¨ãƒªã‚¢  
    ------------------------------------------------->
  <!-- <div id="stampListContainer" class="flex justify-between px-1">
    <img src="img/stamp01.png" alt="Stamp 01" class="image w-1/3 px-1 rounded-lg" data-stamp-index="0">
    <img src="img/stamp02.png" alt="Stamp 02" class="image w-1/3 px-1 rounded-lg" data-stamp-index="1">
    <img src="img/stamp03.png" alt="Stamp 03" class="image w-1/3 px-1 rounded-lg" data-stamp-index="2">
  </div> -->

  <div id="stampListContainer" class="flex justify-between p-1">
    <div class="stamp-container w-1/3 px-1">
      <img src="img/stamp01.png" alt="Stamp 01" class="image rounded-lg" data-stamp-index="0">
      <div class="stamp-click-count" data-stamp-index="0"></div>
    </div>
    <div class="stamp-container w-1/3 px-1">
      <img src="img/stamp02.png" alt="Stamp 02" class="image rounded-lg" data-stamp-index="1">
      <div class="stamp-click-count" data-stamp-index="1"></div>
    </div>
    <div class="stamp-container w-1/3 px-1">
      <img src="img/stamp03.png" alt="Stamp 03" class="image rounded-lg" data-stamp-index="2">
      <div class="stamp-click-count" data-stamp-index="2"></div>
    </div>
  </div>

  <!-- <div id="stampSelections"></div> -->
  <!----------------------------------------------
    â­ï¸ãƒ”ãƒƒãƒç™»å£‡è€…è¡¨ç¤ºã‚¨ãƒªã‚¢
    ------------------------------------------------->
  <div>
    <div id="personWrapper" style="z-index: 10;">
      <img style="position: absolute; bottom: 0;" />
    </div>

    <div id="personInfo" class="ml-4 mb-4">
      <div class="mb-4">
        <div id="organization" class="text-xl"></div>
        <div id="title"></div>
        <div id="name" class="text-4xl"></div>
      </div>
      <div>
        <div>
          speaker select
        </div>
        <div class="btn-container">
          <button data-id="1">1</button>
          <button data-id="2">2</button>
          <button data-id="3">3</button>
          <button data-id="4">4</button>
          <button data-id="5">5</button>
          <button data-id="6">6</button>
          <button data-id="7">7</button>
          <button data-id="8">8</button>
        </div>
      </div>
    </div>
  </div>
  </section>


  <!----------------------------------------------
    â­ï¸ãƒãƒ¼ãƒˆãƒãƒ¼ã‚¯
    ------------------------------------------------->
  <div class="circle">
    <img src="img/heart2.png" class="heart" id="heartImage" />
  </div>


  <script type="module">
    //------------------------------------------
    // â–¼firebaseãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¨javaScriptã‚’é€£æºã•ã›ã‚‹
    //------------------------------------------


    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.3.0/firebase-app.js";

    // firebase firestoreã¨ã‚„ã‚Šå–ã‚Šã‚’ã™ã‚‹è¨­å®š
    import {
      getFirestore,
      collection,
      addDoc,
      serverTimestamp,
      query,
      orderBy, //ãƒ‡ãƒ¼ã‚¿ã®ã‚½ãƒ¼ãƒˆ
      onSnapshot, // Firestore ä¸Šã«ä¿å­˜ã•ã‚Œã¦ã„ã‚‹ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
      doc,
      deleteDoc,
      updateDoc,
      getDocs,
      getDoc,
      increment,
    } from "https://www.gstatic.com/firebasejs/10.3.0/firebase-firestore.js";

    // firebase storageã¨ã‚„ã‚Šå–ã‚Šã‚’ã™ã‚‹è¨­å®š
    import {
      getStorage,
      ref,
      uploadBytes,
      getDownloadURL,
    } from "https://www.gstatic.com/firebasejs/10.3.0/firebase-storage.js";

    // ã‚¦ã‚§ãƒ–ã‚¢ãƒ—ãƒªã®Firebaseã®è¨­å®š
    const firebaseConfig = {
      apiKey: "",
      authDomain: "tvcha-9cae7.firebaseapp.com",
      projectId: "tvcha-9cae7",
      storageBucket: "tvcha-9cae7.appspot.com",
      messagingSenderId: "866848033597",
      appId: "1:866848033597:web:c6887382eb14ee58351354",
    };

    // Firebaseã®åˆæœŸåŒ–
    const app = initializeApp(firebaseConfig);

    // Firebaseã‚¢ãƒ—ãƒªã¨Cloud Storageã®é€£æºã‚’åˆæœŸåŒ–ã—ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã™ã‚‹
    const storage = getStorage(app);

    // dbã«å¯¾ã—ã¦ãƒ‡ãƒ¼ã‚¿ã®è¿½åŠ ã‚„å–å¾—ãŒã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹
    const db = getFirestore(app);

    // ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã®åå‰ã‚’å®šç¾©
    const collectionName = "startup_kyushu2023";
    // const collectionUsernName = "alter-user";

    // ğŸ”½ ãƒ‡ãƒ¼ã‚¿å–å¾—æ¡ä»¶ã®æŒ‡å®šï¼ˆä»Šå›ã¯orderé †ã«ä¸¦ã³æ›¿ãˆã¦å–å¾—ï¼‰
    const q = query(collection(db, collectionName), orderBy("order", "desc"));


    //----------------------------------------
    // â–¼ãƒãƒ¼ãƒˆã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸæ™‚ã®é–¢æ•°
    //----------------------------------------
    const heartClick = () => {
      const heartImage = document.getElementById('heartImage');

      heartImage.addEventListener('click', async () => {

        heartImage.style.transition = 'none'; // ä¸€æ™‚çš„ã«transitionã‚’ç„¡åŠ¹ã«ã™ã‚‹
        heartImage.style.opacity = "0.5";  // Opacity ã‚’ 0.5 ã«è¨­å®š

        // å°‘ã—é…å»¶ã•ã›ã¦ opacity ã‚’ 1 ã«æˆ»ã™
        setTimeout(() => {
          heartImage.style.transition = '';
          heartImage.style.opacity = "1";
        }, 10);

        await updateDoc(doc(db, collectionName, 'qR17Y24YzQdUyrrMwKzs'), {
          count: increment(1)
        });
      });
    };

    heartClick();

    //----------------------------------------
    // â–¼ã‚¹ã‚¿ãƒ³ãƒ—ã®é…åˆ—
    //----------------------------------------
    const displayMapping = {
      "1": ["cwXYkq3piAbvAhDn1Xjs", "qpc0uA78IuoDvbghk9mB", "jealtUQHv1QQrNcAiwuq"],
      "2": ["6zYKOcDVNpyfXmVxCvKl", "scGcrWzRYTxyWFvSvmRN", "Zlt5ZxigZOrmxnuKiUbQ"],
      "3": ["IziClSdR2AhlXWE0O3tp", "eTCk6wN3Ftygfx8VUuWv", "efSL8QRl9vKg0WqVc5hS"],
      "4": ["GMraxjKm9snDEnXb8x6V", "QflvlNPABNHewYLZ3X4l", "yUehqeFwYsudM0HWYsZT"],
      "5": ["fAtESPKJcNQjhFn1KRXx", "8xkbKXJhEkDv0zXeDHns", "dw7TwBDHqb3iDyjHLQ7O"],
      "6": ["GnkpqkuFdwUHQbxY3PPV", "0WWAnyU83WamPOeQPe8B", "9f1q1uZZdzVE7bBNXKAv"],
      "7": ["i4CrW55ohJ9CWaaa0OED", "yfIPjgcYpm5PH30XfzgN", "7ZS4syokyxCNEGIfjRBU"],
      "8": ["zoT83w3SmYRD9spkjCxW", "A9W8CHH0jETzMk8xGe9j", "r1Jl2b6z8pTyTjybp3rH"]
    };


    //----------------------------------------
    // â–¼ã‚«ã‚¦ãƒ³ãƒˆã‚’è¡¨ç¤ºã™ã‚‹é–¢æ•°
    //----------------------------------------
    const updateClickCounts = async () => {
      const btnId = localStorage.getItem("lastClicked") || "1";
      const stampIds = displayMapping[btnId];

      for (let i = 0; i < stampIds.length; i++) {
        const stampId = stampIds[i];
        const countDoc = await getDoc(doc(db, collectionName, stampId));
        const count = countDoc.data().count;
        document.querySelector(`.stamp-click-count[data-stamp-index="${i}"]`).innerText = count;
      }
    }


    //----------------------------------------
    // â–¼ã‚¹ã‚¿ãƒ³ãƒ—ç”»åƒã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸæ™‚ã®ã‚¯ãƒ©ã‚¹ä»˜ä¸ã®é–¢æ•°
    //----------------------------------------
    const applyStampClickAnimation = (image) => {
      image.classList.add('clicked-image');

      setTimeout(() => {
        image.classList.remove('clicked-image');
      }, 2000);
    };

    //----------------------------------------
    // â–¼ã‚¹ã‚¿ãƒ³ãƒ—ç”»åƒã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸæ™‚ã®stampIdå–å¾—é–¢æ•°
    //----------------------------------------
    const getStampInfoOnClick = () => {
      document.querySelectorAll('.image').forEach(image => {

        image.addEventListener('click', () => {
          const btnId = localStorage.getItem("lastClicked") || "1";
          const stampIndex = image.getAttribute('data-stamp-index');
          const stampId = displayMapping[btnId][stampIndex];

          applyStampClickAnimation(image);
          triggerStampAction(btnId, stampId);
          console.log(btnId, stampId);
        });
      });
    };
    document.addEventListener('DOMContentLoaded', getStampInfoOnClick);

    //----------------------------------------
    // ã‚¯ãƒªãƒƒã‚¯ã•ã‚ŒãŸã‚¹ã‚¿ãƒ³ãƒ—ã®URLã‚’æ ¼ç´ã™ã‚‹é…åˆ—
    //----------------------------------------
    let clickStamp = "";
    const clickStamps = [];
    const canvas = document.getElementById('overlay');
    const ctx = canvas.getContext('2d');
    const stamps = []; // ã‚¹ã‚¿ãƒ³ãƒ—ã®æƒ…å ±ã‚’ä¿æŒã™ã‚‹é…åˆ—

    //----------------------------------------
    // â–¼æœ€åˆã®ã‚¹ã‚¿ãƒ³ãƒ—ç”»åƒãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿
    //----------------------------------------

    const initialSnapshot = await getDocs(q);
    const initialArray = [];
    initialSnapshot.docs.forEach(function (doc) {
      const document = {
        id: doc.id,
        data: doc.data(),
      };
      initialArray.push(document);
    });
    const initialImageUrls = []; // imageUrlsã‚’åˆæœŸåŒ–ã—ã¦ãŠã
    const initialPointData = []; // pointDataã‚’åˆæœŸåŒ–ã—ã¦ãŠã

    initialArray.forEach(function (document, index) {
      // countDataã«document.data.countã‚’è¿½åŠ 
      initialPointData.push(document.data.point);
      // imageUrlsã«document.data.imgã‚’è¿½åŠ 
      initialImageUrls.push(document.data.img);
    });

    //----------------------------------------
    // â–¼ã‚¹ã‚¿ãƒ³ãƒ—ã‚’ã‚¯ãƒªãƒƒã‚¯ã§ããªãã™ã‚‹é–¢æ•°
    //----------------------------------------

    const addNeverClickableClass = (btnId) => {
      if (!btnId) {
        btnId = localStorage.getItem("lastClicked");
      }

      // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‹ã‚‰ç›´è¿‘ã«æŠ¼ã—ãŸãƒœã‚¿ãƒ³ã¨stampSelectionsã‚’å–å¾—
      const index = localStorage.getItem("lastClicked");
      const storedStates = JSON.parse(localStorage.getItem("stampSelections") || '[]');

      if (storedStates[btnId - 1] !== null) {

        const targetElements = document.querySelectorAll('.image');

        targetElements.forEach((targetElement) => {
          targetElement.classList.add('never-clickable');
          targetElement.classList.remove('image');
        });
      } else if (storedStates[btnId - 1] === null) {
        const targetElements = document.querySelectorAll('.never-clickable');

        targetElements.forEach((targetElement) => {
          targetElement.classList.add('image');
          targetElement.classList.remove('never-clickable');
        });
      };
    };

    //----------------------------------------
    // â–¼ãƒ”ãƒƒãƒç™»å£‡è€…ãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠã‚’è¨­å®šã™ã‚‹
    //----------------------------------------
    // ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ãŸã‚‰ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ç›´è¿‘ã«ãŠã—ãŸç•ªå·ã‚’ä¿å­˜ã—ã€æŠ¼ã—ãŸãƒœã‚¿ãƒ³ã‚’ãƒã‚¤ãƒ©ã‚¤ãƒˆè¡¨ç¤º
    // ã•ã‚‰ã«ã‚¹ã‚¿ãƒ³ãƒ—ã‚’æŠ¼ã—ã¦ã„ãŸã‚‰æŠ¼ã›ãªã„ã‚ˆã†ã«ã™ã‚‹
    const initializeButtons = () => {
      const buttons = document.querySelectorAll("button");

      buttons.forEach((button) => {
        const btnId = button.getAttribute("data-id");

        button.addEventListener("click", () => {
          storeLastClicked(btnId);
          highlightButton(btnId);
          addNeverClickableClass(btnId);
          updateClickCounts();
        });
      });
    };

    //----------------------------------------
    // â–¼ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ç›´è¿‘ã«ãŠã—ãŸç•ªå·ã‚’ä¿å­˜
    //----------------------------------------
    const storeLastClicked = (btnId) => {
      if (!btnId) {
        btnId = localStorage.getItem("lastClicked") || "1";
      }
      localStorage.setItem("lastClicked", btnId);
      updatePersonImage();
    };

    //----------------------------------------
    // â–¼æŠ¼ã—ãŸãƒœã‚¿ãƒ³ã‚’ãƒã‚¤ãƒ©ã‚¤ãƒˆè¡¨ç¤º
    //----------------------------------------
    const highlightButton = (btnId) => {
      // ã‚‚ã—btnIdãŒæ¸¡ã•ã‚Œã¦ã„ãªã„å ´åˆã€LocalStorageã‹ã‚‰å–å¾—
      if (!btnId) {
        btnId = localStorage.getItem("lastClicked");
      };

      const buttons = document.querySelectorAll("button");
      buttons.forEach((button) => {
        button.style.background = button.getAttribute("data-id") === btnId ? "#9c1500" : "";
      });
    }

    //----------------------------------------
    // â–¼ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ã©ã®ãƒœã‚¿ãƒ³ç•ªå·ã§ã©ã®ã‚¹ã‚¿ãƒ³ãƒ—ã‚’æŠ¼ã—ãŸã‹ä¿å­˜ã™ã‚‹é–¢æ•°
    //----------------------------------------
    const stampButtonClicked = (btnId, stampId) => {
      const storedStates = JSON.parse(localStorage.getItem("stampSelections") || '[]');

      while (storedStates.length < 8) {
        storedStates.push(null);
      }

      storedStates[btnId - 1] = stampId;
      localStorage.setItem("stampSelections", JSON.stringify(storedStates));

      // ã‚¹ã‚¿ã‚¤ãƒ«ã‚’é©ç”¨ã™ã‚‹é–¢æ•°ã‚’å‘¼ã³å‡ºã™
      updateButtonStyles();
    };

    //----------------------------------------
    // ãƒ”ãƒƒãƒç™»å£‡è€…ãƒœã‚¿ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ«
    //----------------------------------------

    const updateButtonStyles = () => {
      const storedStates = JSON.parse(localStorage.getItem("stampSelections") || '[]');
      const buttons = document.querySelectorAll('.btn-container button');

      buttons.forEach((button, index) => {
        const state = storedStates[index];

        // ã‚¯ãƒ©ã‚¹ã‚’ãƒªã‚»ãƒƒãƒˆ
        button.classList.remove('button-black', 'button-gray');

        if (state === null) {
          button.classList.add('button-black');
        } else {
          button.classList.add('button-gray');
        }
      });
    }

    //----------------------------------------
    // â–¼ä½œæ¥­ç”¨ã®è¡¨ç¤ºé–¢æ•°
    //----------------------------------------
    const displayStampSelections = () => {
      // LocalStorageã‹ã‚‰stampSelectionsã‚’å–å¾—ã—ã¦é…åˆ—ã¨ã—ã¦ãƒ‘ãƒ¼ã‚¹ã™ã‚‹
      const storedStates = JSON.parse(localStorage.getItem("stampSelections") || '[]');

      // æ–°ã—ã„ãƒ†ãƒ¼ãƒ–ãƒ«è¦ç´ ã‚’ä½œæˆã™ã‚‹
      const table = document.createElement("table");
      const tbody = document.createElement("tbody");

      storedStates.forEach((item, index) => {
        const row = document.createElement("tr");

        // Indexã®ã‚»ãƒ«ã‚’ä½œæˆã—ã¦è¿½åŠ 
        const indexCell = document.createElement("td");
        indexCell.textContent = `${index + 1}:`;
        row.appendChild(indexCell);

        // å€¤ã®ã‚»ãƒ«ã‚’ä½œæˆã—ã¦è¿½åŠ 
        const valueCell = document.createElement("td");
        valueCell.textContent = item === null ? "null" : item;
        row.appendChild(valueCell);

        tbody.appendChild(row);
      });

      table.appendChild(tbody);
    };

    //----------------------------------------
    // â–¼ç™»å£‡è€…ã®ç”»åƒã‚’è¡¨ç¤ºã™ã‚‹
    //----------------------------------------

    // ã‚¢ãƒ­ãƒ¼é–¢æ•°ã§å®šç¾©
    const updatePersonWrapperStyle = () => {
      const personWrapper = document.getElementById('personWrapper');
    };

    const updatePersonImage = () => {
      const personWrapper = document.getElementById('personWrapper');
      const imgElement = personWrapper.querySelector('img');

      // localStorageã‹ã‚‰lastClickedã®å€¤ã‚’å–å¾—
      const lastClicked = localStorage.getItem("lastClicked") || "1";

      // lastClickedã®å€¤ã«åŸºã¥ã„ã¦ç”»åƒã®ãƒ•ã‚¡ã‚¤ãƒ«åã‚’å‹•çš„ã«ç”Ÿæˆ
      const imgSrc = `img/${lastClicked.padStart(2, '0')}.png`;

      // ç”»åƒã®srcå±æ€§ã‚’æ›´æ–°
      imgElement.src = imgSrc;

      // ç”»åƒã®ã‚µã‚¤ã‚ºã‚’å¤‰æ›´
      imgElement.style.width = '80%';  // ä¾‹: å…ƒã®ã‚µã‚¤ã‚ºã®80%ã«ã™ã‚‹

      // ç”»åƒã‚’ãƒ‡ãƒã‚¤ã‚¹ã®å³ç«¯ã«æ¥ã™ã‚‹ã‚ˆã†ã«ã™ã‚‹
      imgElement.style.position = 'absolute';
      imgElement.style.right = '0';

      // é–¢é€£ã™ã‚‹æƒ…å ±ï¼ˆå›£ä½“åã€å½¹è·ã€åå‰ï¼‰ã‚’å–å¾—ã—ã¦æ›´æ–°
      const person = persons[lastClicked - 1]; // é…åˆ—ã¯0ã‹ã‚‰å§‹ã¾ã‚‹ãŸã‚ã€-1ã—ã¾ã™

      // DOMè¦ç´ ã‚’å–å¾—ã—ã¦æ›´æ–°
      const orgElement = document.getElementById("organization");
      const titleElement = document.getElementById("title");
      const nameElement = document.getElementById("name");

      orgElement.textContent = person.organization;
      titleElement.textContent = person.title;
      nameElement.textContent = person.name;

      // ç”»åƒã¨ãƒ†ã‚­ã‚¹ãƒˆã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ãƒªã‚»ãƒƒãƒˆ
      imgElement.classList.remove('fade-in-from-right');
      orgElement.classList.remove('fade-in-from-right');
      titleElement.classList.remove('fade-in-from-right');
      nameElement.classList.remove('fade-in-from-right');

      // ãƒªãƒ•ãƒ­ãƒ¼ã‚’ãƒˆãƒªã‚¬ãƒ¼ã—ã¦ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å†ç”Ÿ
      void imgElement.offsetWidth;
      void orgElement.offsetWidth;
      void titleElement.offsetWidth;
      void nameElement.offsetWidth;

      // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¯ãƒ©ã‚¹ã‚’è¿½åŠ 
      imgElement.classList.add('fade-in-from-right');
      orgElement.classList.add('fade-in-from-right');
      titleElement.classList.add('fade-in-from-right');
      nameElement.classList.add('fade-in-from-right');
    };

    //----------------------------------------
    // â–¼ç™»å£‡è€…ã®æƒ…å ±ã‚’è¡¨ç¤ºã™ã‚‹
    //----------------------------------------
    const persons = [
      {
        "organization": "å­¦ç”Ÿã‚¢ãƒ—ãƒªé–‹ç™ºå›£ä½“Divers",
        "title": "ä»£è¡¨",
        "name": "å†…å±± å¤§è¼”"
      },
      {
        "organization": "Gigaæ ªå¼ä¼šç¤¾",
        "title": "äº‹æ¥­æ‹…å½“å–ç· å½¹",
        "name": "æ‰å±± éš†å¿—"
      },
      {
        "organization": "è¥¿å—å­¦é™¢å¤§å­¦",
        "title": "å­¦ç”Ÿ",
        "name": "é«˜ç€¬ æœé™½"
      },
      {
        "organization": "SEKIYA.so",
        "title": "ä»£è¡¨",
        "name": "å¯ºæœ¬ è–"
      },
      {
        "organization": "æ ªå¼ä¼šç¤¾xCura",
        "title": "ä»£è¡¨å–ç· å½¹",
        "name": "æ–°å¶‹ ç¥ä¸€æœ—"
      },
      {
        "organization": "æ ªå¼ä¼šç¤¾Booon",
        "title": "ä»£è¡¨å–ç· å½¹",
        "name": "æ©‹çˆª æµ·"
      },
      {
        "organization": "ã²ã ç¦",
        "title": "ä»£è¡¨",
        "name": "æ—¥é«™ ç¤¼é”"
      },
      {
        "organization": "æ ªå¼ä¼šç¤¾Mahal.KitaQ",
        "title": "ä»£è¡¨å–ç· å½¹",
        "name": "å®®å‚ æ˜¥èŠ±"
      }
    ];


    //----------------------------------------
    // â–¼åˆå›èª­ã¿è¾¼ã¿æ™‚ã®æŒ™å‹•
    //----------------------------------------

    initializeButtons();
    storeLastClicked();
    stampButtonClicked();
    highlightButton();
    addNeverClickableClass();
    displayStampSelections();
    updatePersonWrapperStyle();
    window.addEventListener('resize', updatePersonWrapperStyle);
    updatePersonImage();
    updateButtonStyles();
    updateClickCounts();

    //----------------------------------------
    // â–¼ã‚¹ã‚¿ãƒ³ãƒ—ã‚¯ãƒªãƒƒã‚¯é–¢æ•°ã€ãƒã‚¤ãƒ³ãƒˆåŠ ç®—é–¢æ•°
    //----------------------------------------
    const triggerStampAction = async (btnId, stampId) => {

      await updateDoc(doc(db, collectionName, stampId), {
        count: increment(1)
      });

      // ãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠã‚’åˆæœŸåŒ–
      initializeButtons();
      stampButtonClicked(btnId, stampId);
      addNeverClickableClass(btnId);
      displayStampSelections();
      updateClickCounts();
    };

    //----------------------------------------
    // â–¼å¤‰æ›´ãƒœã‚¿ãƒ³é–¢æ•°
    //----------------------------------------

    // ç”»åƒã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ URL ã‚’å–å¾—ã—ã¦è¡¨ç¤ºã™ã‚‹ãŸã‚ã®é–¢æ•°
    function displayImage(downloadURL, element) {
      // ã™ã§ã«ç”»åƒãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹å ´åˆã¯å‰Šé™¤ã™ã‚‹
      while (element.firstChild) {
        element.removeChild(element.firstChild);
      }

      // æ–°ã—ã„ç”»åƒã‚’è¡¨ç¤º
      const img = document.createElement("img");
      img.src = downloadURL;
      element.appendChild(img);
    };

    //----------------------------------------
    // â–¼canvasèƒŒæ™¯ã®ç”»åƒã®å¤§ãã•ã‚’å–å¾—ã™ã‚‹é–¢æ•°
    //----------------------------------------
    let canvasImage = document.querySelector('.canvas-wrapper img');

    // ç”»åƒãŒèª­ã¿è¾¼ã¾ã‚ŒãŸã‚‰ã€ã‚­ãƒ£ãƒ³ãƒã‚¹ã®ã‚µã‚¤ã‚ºã‚’è¨­å®šã™ã‚‹
    canvasImage.addEventListener('load', function () {
      canvas.width = canvasImage.width;
      canvas.height = canvasImage.height;
    });

    // ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ãŒãƒªã‚µã‚¤ã‚ºã•ã‚ŒãŸã¨ãã‚‚ã€ã‚­ãƒ£ãƒ³ãƒã‚¹ã®ã‚µã‚¤ã‚ºã‚’å†è¨­å®šã™ã‚‹
    window.addEventListener('resize', function () {
      canvas.width = canvasImage.width;
      canvas.height = canvasImage.height;
    });

    // ç”»åƒãŒã™ã§ã«èª­ã¿è¾¼ã¾ã‚Œã¦ã„ã‚‹å ´åˆã®å¯¾å‡¦
    if (canvasImage.complete) {
      canvas.width = canvasImage.width;
      canvas.height = canvasImage.height;
    }

    // ãƒ‡ãƒ¼ã‚¿å–å¾—å‡¦ç†(ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ä¸Šã§ãƒ‡ãƒ¼ã‚¿ã®å¤‰æ›´ãŒç™ºç”Ÿã—ãŸã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§ {} å†…ã®å‡¦ç†ã‚’å®Ÿè¡Œ)
    onSnapshot(q, (querySnapshot) => {
      querySnapshot.docChanges().forEach((change) => {
        if (change.type === "modified") {
          const stampURL = change.doc.data().img;
          drawImageOnCanvas(stampURL);
        }
      });
    });

    //----------------------------------------
    // â–¼åŸºæœ¬ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’è¨­å®š
    //----------------------------------------
    // const targetX = (canvas.width) / 2// ç”»é¢ä¸­å¤®ã®Xåº§æ¨™
    const targetX = Math.random() * canvas.width;
    // const variance = canvas.width / 40;  // ã“ã‚Œã¯ã©ã‚Œãã‚‰ã„å¤‰å‹•ã™ã‚‹ã‹ã®ç¯„å›²ã‚’æŒ‡å®šã—ã¾ã™ã€‚ã“ã®å ´åˆã€ç”»é¢ã®1/4ã®ç¯„å›²ã§å¤‰å‹•ã—ã¾ã™ã€‚
    // const targetX = canvas.width / 2 + (Math.random() - 0.5) * 2 * canvas.width / 40;  // ç”»é¢ä¸­å¤®ã®Xåº§æ¨™ã‚’åŸºç‚¹ã«ãƒ©ãƒ³ãƒ€ãƒ ãªå€¤ã‚’åŠ ãˆã‚‹

    const targetY = (canvas.height) / 2; // ç”»é¢ä¸­å¤®ã®Yåº§æ¨™
    const maxSize = 200; // æœ€å¤§ã‚µã‚¤ã‚º
    let friction = 0.95; // æ‘©æ“¦ä¿‚æ•°
    const initialGrowthRate = 2; // åˆæœŸã®æˆé•·ç‡

    //----------------------------------------
    // â–¼ã‚¹ã‚¿ãƒ³ãƒ—æç”»é–¢æ•°
    //----------------------------------------
    let isAnimationRunning = false;

    // clickStampãŒæ›´æ–°ã•ã‚ŒãŸã‚‰æç”»ã™ã‚‹ãŸã‚ã®é–¢æ•°
    function drawImageOnCanvas(stampURL) {

      const image = document.createElement('img');
      image.onload = function () {
        //----------------------------------------
        // â–¼ã‚¹ã‚¿ãƒ³ãƒ—ã‚’é…åˆ—ã«å…¥ã‚Œã‚‹
        //----------------------------------------

        let posX, posY, velocityX;

        if (Math.random() < 0.5) {
          posX = 0;
          // velocityX = 10;

          const velocities = [1, 2, 4, 6, 0];
          const randomIndex = Math.floor(Math.random() * velocities.length);
          velocityX = velocities[randomIndex];

          posY = Math.random() * canvas.height / 4 * 3;
        }
        else {
          posX = canvas.width;
          // ãƒ©ãƒ³ãƒ€ãƒ ãªé€Ÿåº¦ã‚’è¨­å®š

          const velocities = [-3, -5, -7, -9, -11];
          const randomIndex = Math.floor(Math.random() * velocities.length);
          velocityX = velocities[randomIndex];
          // velocityX = -45;

          posY = Math.random() * canvas.height / 4 * 3;
        }


        const stampInfo = {
          image: image,
          posX: posX,
          posY: posY,
          velocityX: velocityX,
          velocityY: 0,
          size: 0,
          alpha: 1.0,
          isAnimating: true,
        };
        stamps.push(stampInfo);


        // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’é–‹å§‹
        if (!isAnimationRunning) {
          isAnimationRunning = true;
          animate();
        }
      };
      image.src = stampURL; // clickStampsã«ç”»åƒã®URLã‚’æ ¼ç´
    };
    //----------------------------------------
    // â–¼ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã®é–¢æ•°
    //----------------------------------------

    // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’é–‹å§‹
    // animate();

    function animate() {
      ctx.clearRect(0, 0, canvas.width, canvas.height); // Canvasã‚’ã‚¯ãƒªã‚¢

      // é€Ÿåº¦ã‚’æ›´æ–°
      for (let i = 0; i < stamps.length; i++) {
        const stamp = stamps[i];

        if (stamp.isAnimating) {
          stamp.velocityX *= friction; // æ‘©æ“¦ã‚’é©ç”¨
          stamp.velocityY *= friction; // æ‘©æ“¦ã‚’é©ç”¨

          // ä½ç½®ã‚’æ›´æ–°
          stamp.posX += stamp.velocityX; // é€Ÿåº¦ã«ã‚ˆã‚‹ä½ç½®ã®å¤‰åŒ–
          stamp.posY += stamp.velocityY; // é€Ÿåº¦ã«ã‚ˆã‚‹ä½ç½®ã®å¤‰åŒ–

          // ã‚µã‚¤ã‚ºã‚’æ›´æ–°
          const distanceToTarget = Math.sqrt((targetX - stamp.posX) ** 2 + (targetY - stamp.posY) ** 2);
          const growthRate = initialGrowthRate * (1 + distanceToTarget / canvas.width); // è·é›¢ã«å¿œã˜ã¦æˆé•·ç‡ã‚’èª¿æ•´

          // ã‚µã‚¤ã‚ºã‚’æ›´æ–°
          if (stamp.size < 150) {
            stamp.size += growthRate; // æˆé•·ç‡ã«ã‚ˆã‚‹ã‚µã‚¤ã‚ºã®å¢—åŠ 
          } else if (stamp.size >= 150 && stamp.size < maxSize) {
            stamp.size += growthRate; // 400ã‹ã‚‰500ã®é–“ã‚‚æˆé•·ã‚’ç¶šã‘ã‚‹
            stamp.alpha -= 0.05; // é€æ˜åº¦ã‚’ä¸‹ã’ã‚‹
          }
          ctx.globalAlpha = stamp.alpha;

          // ã‚¹ã‚¿ãƒ³ãƒ—ã®ä¸­å¤®åº§æ¨™ã‚’è¨ˆç®—
          const centerX = stamp.posX + stamp.size / 2;
          const centerY = stamp.posY + stamp.size / 2;

          // ã‚¹ã‚¿ãƒ³ãƒ—ã®ä¸­å¤®åº§æ¨™ã‚’ä¸­å¿ƒã«æç”»
          ctx.drawImage(stamp.image, centerX - stamp.size / 2, centerY - stamp.size / 2, stamp.size, stamp.size);

          if (stamp.alpha <= 0 || stamp.size > 200) {
            stamp.alpha = 0; // é€æ˜åº¦ãŒ-10ã®ã¾ã¾ã‚­ãƒ¼ãƒ—ã™ã‚‹
            // stamps.shift(); // é…åˆ—ã®å…ˆé ­ã‹ã‚‰å‰Šé™¤


            stamp.isAnimating = false;
          };
        };
      }
      if (stamps.length > 0) {
        requestAnimationFrame(animate);
      }
    };

    //----------------------------------------
    // â–¼ãƒ€ãƒ–ãƒ«ã‚¯ãƒªãƒƒã‚¯ã•ã‚Œãªã„ã‚ˆã†ã«ã™ã‚‹é–¢æ•°
    //----------------------------------------

    document.addEventListener('dblclick', function (e) {
      e.preventDefault();
    });


  </script>
</body>

</html>