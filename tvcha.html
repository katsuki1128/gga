<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport"
    content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no">

  <title>GGA2023tvcha</title>

  <!-- CSS & Tailwind -->
  <!-- <link rel="stylesheet" href="css/reset.css" /> -->
  <link rel="stylesheet" href="css/style.css" />
  <script src="https://cdn.tailwindcss.com"></script>

</head>

<body>
  <!----------------------------------------------
    ⭐️タイトル
    ------------------------------------------------->

  <section id="header" class="bg-gray-200">
    <div class="flex flex-col items-center justify-center px-3 pt-3 pb-3 mx-auto">
      <div class="w-full bg-white rounded-lg shadow sm:max-w-3xl md:w-4/5 xl:p-0">
        <div class="p-3 space-y-4 md:space-y-6 sm:p-8">
          <div>
            <img class="w-full h-15 mr-2" src="./img/uretoru_logo.png" alt="logo" />
            <div class="text-center mt-4 mb-0 mx-0" id="contentDiv">
              <div class="text-left mb-1">
                <p class="text-lg">
                  ⭐️Aマサル/B伊藤舞スタンプで応援
                </p>
                <p class="text-lg">
                  ⭐️スタンプがテレビに飛んでいくよ
                </p>
                <p class="text-lg">
                  ⭐️音声が出ます♪
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <section id="stampWrapper">
    <!----------------------------------------------
    ⭐️スタンプ表示エリア
    ------------------------------------------------->
    <div>
      <div id="stampListContainer" class="flex flex-wrap justify-between p-1">
      </div>
    </div>
  </section>
  <section id="stampCountWrapper" class="bg-gray-200">
    <div class="flex flex-col items-center justify-center px-3 pt-3 pb-3 mx-auto">
      <div class="w-full bg-white rounded-lg shadow sm:max-w-3xl md:w-4/5 xl:p-0">
        <div class="p-3" id="slot">
          <div class="mb-2 text-lg text-gray-700 font-medium text-center" id="thanks">
            ⛑ 送れるスタンプは１日３回です 😊
          </div>
          <div>
            <div class="dotted-circles-container">
              <div class="dotted-circle image-slot">1</div>
              <div class="dotted-circle image-slot">2</div>
              <div class="dotted-circle image-slot">3</div>
            </div>
          </div>
        </div>
      </div>

      <div class="flex flex-col items-center mt-2">
        <div class="my-2">
          <img src="./img/station_logo.png" alt="logo" class="w-32 h-auto" />
        </div>
        <div>
          <p class="text-xs">© FUKUOKA BROADCASTING SYSTEM CORP.</p>
        </div>
      </div>
  </section>


  <section>
    <div class="flex flex-col items-center justify-center">
      <div class="canvas-wrapper relative">
        <canvas id="overlay"></canvas>
      </div>
    </div>
  </section>




  <!----------------------------------------------
    ⭐️実際のUIへのリンク
    ------------------------------------------------->
  <div>
    <a href="index.html">GGA用UI

  </div>

  <script type="module">
    //------------------------------------------
    // ▼firebaseプロジェクトとjavaScriptを連携させる
    //------------------------------------------


    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.3.0/firebase-app.js";

    // firebase firestoreとやり取りをする設定
    import {
      getFirestore,
      collection,
      addDoc,
      serverTimestamp,
      query,
      orderBy, //データのソート
      onSnapshot, // Firestore 上に保存されているデータを取得
      doc,
      deleteDoc,
      updateDoc,
      getDocs,
      getDoc,
      increment,
    } from "https://www.gstatic.com/firebasejs/10.3.0/firebase-firestore.js";

    // firebase storageとやり取りをする設定
    import {
      getStorage,
      ref,
      uploadBytes,
      getDownloadURL,
    } from "https://www.gstatic.com/firebasejs/10.3.0/firebase-storage.js";

    // ウェブアプリのFirebaseの設定
    const firebaseConfig = {
      apiKey: "",
      authDomain: "tvcha-9cae7.firebaseapp.com",
      projectId: "tvcha-9cae7",
      storageBucket: "tvcha-9cae7.appspot.com",
      messagingSenderId: "866848033597",
      appId: "1:866848033597:web:c6887382eb14ee58351354",
    };

    // Firebaseの初期化
    const app = initializeApp(firebaseConfig);

    // FirebaseアプリとCloud Storageの連携を初期化しセットアップする
    const storage = getStorage(app);

    // dbに対してデータの追加や取得ができるようにする
    const db = getFirestore(app);

    // コレクションの名前を定義
    const collectionName = "gga";
    // const collectionUsernName = "alter-user";

    // 🔽 データ取得条件の指定（今回はorder順に並び替えて取得）
    const q = query(collection(db, collectionName), orderBy("order", "desc"));

    //----------------------------------------
    // クリックされたスタンプのURLを格納する配列
    //----------------------------------------
    let clickStamp = "";
    const clickStamps = [];
    const canvas = document.getElementById('overlay');
    const ctx = canvas.getContext('2d');
    const stamps = []; // スタンプの情報を保持する配列

    //----------------------------------------
    // ▼スタンプのクリック数カウント
    //----------------------------------------
    let AGroupCount = 0;
    let BGroupCount = 0;
    let totalCount = 0;
    let AGroupPercentage = 0;
    let BGroupPercentage = 0;

    // AグループとBグループのIDのリスト
    const AGroupIds = ['Sw077n0mreVj9exRh81f', 'xrnvFgD3PCjestA64SGd', 'ZXxNNOE8iKsrg8x3UiZ8', 'hgGsPbYmVKtw1ZLxljcr'];
    const BGroupIds = ['p1DmVCDLRcPBgpdGfTuY', 'NgLy7OAjlR6b7LF3Bfmp', 'xrnvFgD3PCjestA64SGd', 'gfYdaXfqBcumPyn5puV9'];

    //----------------------------------------
    // カウントとパーセンテージを計算する関数

    //----------------------------------------
    const calculateCountsAndPercentages = (docs) => {
      // カウントをリセット
      AGroupCount = 0;
      BGroupCount = 0;
      totalCount = 0;

      // 各ドキュメントのカウントを集計する
      docs.forEach((doc) => {
        const docId = doc.id;
        const docCount = doc.data().count || 0;

        if (AGroupIds.includes(docId)) {
          AGroupCount += docCount;
        }
        if (BGroupIds.includes(docId)) {
          BGroupCount += docCount;
        }
      });

      // 合計カウントとパーセンテージを計算
      totalCount = AGroupCount + BGroupCount;
      AGroupPercentage = (totalCount > 0) ? (AGroupCount / totalCount) * 100 : 0;
      BGroupPercentage = (totalCount > 0) ? (BGroupCount / totalCount) * 100 : 0;

      // 結果をコンソールに出力
      console.log('AGroupCount:', AGroupCount, 'BGroupCount:', BGroupCount);
      console.log('AGroupPercentage:', AGroupPercentage.toFixed(2), 'BGroupPercentage:', BGroupPercentage.toFixed(2));
    };


    //----------------------------------------
    // ▼最初のスタンプ画像データの読み込み
    //----------------------------------------

    const initialSnapshot = await getDocs(q);
    // calculateCountsAndPercentages(initialSnapshot.docs);

    const initialArray = initialSnapshot.docs.map(doc => ({
      id: doc.id,
      data: doc.data(),
    }));

    const initialImageUrls = initialArray.map(doc => doc.data.img);



    // データ取得処理(データベース上でデータの変更が発生したタイミングで {} 内の処理を実行)
    onSnapshot(q, (querySnapshot) => {
      calculateCountsAndPercentages(querySnapshot.docs);
      drawBarGraph(AGroupPercentage, BGroupPercentage);

      querySnapshot.docChanges().forEach((change) => {
        if (change.type === "modified") {
          const stampURL = change.doc.data().img;
          drawImageOnCanvas(stampURL);
          // console.log(stampURL);
        }
      });
    });

    //----------------------------------------
    // ▼スタンプを表示する関数
    //----------------------------------------

    const imageElements = [];

    const renderImages = () => {
      stampListContainer.innerHTML = '';

      initialImageUrls.forEach((imageUrl, index) => {
        const imageWrapper = document.createElement('div');
        imageWrapper.className = 'image-wrapper';

        const imageElement = document.createElement('img');
        imageElement.src = imageUrl;
        imageElement.className = 'image';
        imageElement.style.marginBottom = '8px';
        imageElements.push(imageElement)

        imageWrapper.appendChild(imageElement);

        stampListContainer.appendChild(imageWrapper);
      });
    }
    renderImages();

    // console.log("imageElements", imageElements);

    //----------------------------------------
    // ▼スタンプクリック関数
    //----------------------------------------
    const stampClick = async (stampId) => {

      // Firebaseのクリック数を一つ増やす
      await updateDoc(doc(db, collectionName, stampId), {
        count: increment(1)
      });
      // console.log("カウントが正常に更新されましたよ。");
    };
    //----------------------------------------
    // ▼クリックされたスタンプのIDを取得する関数
    //----------------------------------------

    let isClickDisabled = false; // クリック無効フラグ

    // 画像要素にクリックイベントリスナーを追加
    imageElements.forEach((imageElement, index) => {
      imageElement.addEventListener('click', () => {

        // console.log(imageElement.src);

        // クリックが無効化されている場合は処理をスキップ
        // if (isClickDisabled) return;

        const stampId = initialArray[index].id; // クリックされたドキュメントのIDを取得
        setTimeout(() => {
          stampClick(stampId);
        }, 1000);

        // ボタンが押された時の挙動
        imageElement.classList.add('clicked-image'); // クリックされたら 'clicked-image' クラスを追加
        // isClickDisabled = true; // クリックを無効化

        setTimeout(() => {
          imageElement.classList.remove('clicked-image'); // 一定時間経過後に 'clicked-image' クラスを削除
          // isClickDisabled = false; // 一定時間後にクリックを再度有効にする
        }, 1000);
      });
    });

    //----------------------------------------
    // ▼canvas背景の画像の大きさを取得する関数
    //----------------------------------------

    let canvasImage = document.querySelector('.canvas-wrapper img');

    // ウィンドウがリサイズされたときも、キャンバスのサイズを再設定する
    window.addEventListener('resize', function () {
      canvas.width = canvasImage.width;
      canvas.height = canvasImage.height;
    });

    // 画像がすでに読み込まれている場合の対処
    if (canvasImage.complete) {
      canvas.width = canvasImage.width;
      canvas.height = canvasImage.height;
    }
    //----------------------------------------
    // テレビの中の座標
    //----------------------------------------

    // 矩形の左上隅の座標
    const rectX = canvas.width / 10.2;
    const rectY = canvas.height / 17;

    // 矩形の幅と高さ
    const rectWidth = canvas.width / 1.265;
    const rectHeight = canvas.height / 1.62;

    // 矩形の描画
    // ctx.fillStyle = 'purple';
    // ctx.fillRect(rectX, rectY, rectWidth, rectHeight);

    // 左下の座標
    const bottomLeftX = rectX;
    const bottomLeftY = rectY + rectHeight;

    // 右下の座標
    const bottomRightX = rectX + rectWidth;
    const bottomRightY = rectY + rectHeight;

    // 変数に格納
    let bottomLeft = { x: bottomLeftX, y: bottomLeftY };
    let bottomRight = { x: bottomRightX, y: bottomRightY };


    //----------------------------------------
    // ▼パーセンテージのイーズインアニメーション
    //----------------------------------------

    let previousAGroupPercentage = 0; // 前回のパーセンテージを保持する変数
    let previousBGroupPercentage = 0; // 前回のBGroupPercentageを保持する変数を追加

    function easeInAnimation(startValue, endValue, duration, updateFunction) {
      let startTime = null;

      function animate(time) {
        if (!startTime) startTime = time;

        let elapsedTime = time - startTime;
        let progress = elapsedTime / duration;

        if (progress > 1) progress = 1;

        // イーズインの計算
        let currentValue = startValue + (endValue - startValue) * (progress * progress);

        updateFunction(currentValue);

        if (progress < 1) requestAnimationFrame(animate);
      }

      requestAnimationFrame(animate);
    }

    //----------------------------------------
    // ▼パーセンテージの表示関数
    //----------------------------------------

    function calculatePercentage() {
      // console.log("AGroupCount", AGroupCount, "BGroupCount", BGroupCount)
      let isFirstCall = true;

      // パーセンテージの計算
      const total = AGroupCount + BGroupCount;
      // console.log(total)
      AGroupPercentage = Math.round((AGroupCount / total) * 100); // 小数点を丸める
      BGroupPercentage = 100 - AGroupPercentage;

      // AGroupPercentageの新しい値のアニメーション
      let newAGroupPercentage = Math.round((AGroupCount / total) * 100);

      easeInAnimation(previousAGroupPercentage, newAGroupPercentage, 1000, function (value) {
        document.getElementById("AGroupPercentage").innerHTML = `${Math.round(value)}<span id="Apercentage">%</span>`;
      });

      previousAGroupPercentage = newAGroupPercentage; // 前回のAGroupPercentageを更新

      // BGroupPercentageの新しい値のアニメーション
      let newBGroupPercentage = 100 - newAGroupPercentage;

      easeInAnimation(previousBGroupPercentage, newBGroupPercentage, 1000, function (value) {
        document.getElementById("BGroupPercentage").innerHTML = `${Math.round(value)}<span id="Bpercentage">%</span>`;
      });

      previousBGroupPercentage = newBGroupPercentage; // 前回のBGroupPercentageを更新

      // HTML要素にパーセンテージを表示

      // document.getElementById("AGroupPercentage").innerHTML = `${AGroupPercentage}<span id="Apercentage">%</span>`;
      // document.getElementById("AGroupCount").innerHTML = `${AGroupCount}`;
      // document.getElementById("BGroupPercentage").innerHTML = `${BGroupPercentage}<span id="Bpercentage">%</span>`;
      // document.getElementById("BGroupCount").innerHTML = `${BGroupCount}`;
      // console.log("AGroupPercentage", AGroupPercentage);
      // console.log("BGroupPercentage", BGroupPercentage);

    }
    // drawImageOnCanvas(clickStamp);
    // drawBarGraph(AGroupPercentage, BGroupPercentage);
    // console.log(clickStamp, BGroupPercentage)

    //----------------------------------------
    // ▼スタンプ描画関数
    //----------------------------------------
    let isAnimationRunning = false;

    const GRAVITY = 0.03; // 重力の強さ
    const FRICTION = 0.3; // 摩擦係数
    // const CONSTANT_VELOCITY = 5;

    // clickStampが更新されたら描画するための関数
    // function drawImageOnCanvas(stampURL, stampType) {
    function drawImageOnCanvas(stampURL) {
      const image = document.createElement('img');
      image.className = "stampMoving";
      image.onload = () => {

        const stampInfo = {
          image: image,
          posX: Math.random() * canvas.width,
          posY: rectY + rectHeight - image.height,
          velocityX: 0,
          initialVelocityY: 0.7 + Math.random() * 3,
          velocityY: 0.3 + Math.random(),
          size: 100,
          sizeRate: 0.5 + Math.random() * 0.5,
          isAnimating: true,
          opacity: 1.0,
        };
        // console.log("stampInfo", stampInfo);
        stamps.push(stampInfo);
        // console.log(stamps.length)

        // アニメーションを開始
        if (!isAnimationRunning) {
          isAnimationRunning = true;
          animate();
          // console.log(stamps.length)
        }
      };
      image.src = stampURL; // clickStampsに画像のURLを格納
    };

    //----------------------------------------
    // スタンプの距離を測る関数
    //----------------------------------------

    function areStampsColliding(stamp1, stamp2) {
      const dx = stamp1.posX - stamp2.posX;
      const dy = stamp1.posY - stamp2.posY;
      const distance = Math.sqrt(dx * dx + dy * dy);
      return distance < (stamp1.size + stamp2.size) / 2;
    };

    //----------------------------------------
    // ▼アニメーション全体の関数
    //----------------------------------------
    function animate() {
      ctx.clearRect(0, 0, canvas.width, canvas.height); // Canvasをクリア
      drawBarGraph(AGroupPercentage, BGroupPercentage); // ここでグラフを再描画

      for (let i = 0; i < stamps.length; i++) {
        // 画面の半分に来たら重ならないようにする
        if (stamps[i].posY > canvas.height / 3 * 2) {

          //----------------------------------------
          // ▼スタンプの衝突関数
          //----------------------------------------
          for (let j = i + 1; j < stamps.length; j++) {
            if (areStampsColliding(stamps[i], stamps[j])) {

              // スタンプが重ならないように位置を調整
              const dx = stamps[j].posX - stamps[i].posX;
              const dy = stamps[j].posY - stamps[i].posY;
              const distance = Math.sqrt(dx * dx + dy * dy);
              const overlap = (stamps[i].size / 2 + stamps[j].size / 2) - distance;

              // 重なっている距離に基づいて位置を調整
              const adjustX = (dx / distance) * overlap;
              const adjustY = (dy / distance) * overlap;

              // 位置を調整
              const margin = 10;
              stamps[i].posX -= adjustX / margin;
              stamps[i].posY -= adjustY / margin;
              stamps[j].posX += adjustX / margin;
              stamps[j].posY += adjustY / margin;
            }
          }
        }



        //----------------------------------------
        // ▼アニメーションの関数
        //----------------------------------------
        const stamp = stamps[i];
        // console.log(stamps.length)
        // const newStampSize = stamp.size * 0.5; // スタンプのサイズ
        // const newStampSize = stamp.size * (Math.random() * 0.5 + 0.5); // スタンプのサイズ
        const newStampSize = stamp.size * stamp.sizeRate;

        if (stamp.isAnimating) {
          stamp.posX += stamp.velocityX;

          // 画面のある位置までの場合
          if (stamp.posY <= canvas.height / 3 * 2) {
            // 速度を一定に保つ（適切な一定の速度を設定する）
            stamp.velocityY = stamp.initialVelocityY;
          } else {
            // 画面のある位置を超えた場合、重力の影響を受けて加速する
            stamp.velocityY += (1 + GRAVITY);
          }
          stamp.posY += stamp.velocityY;
          // stamp.posY += stamp.velocityY;
          // console.log([i], "個目がアニメーション中", stamps[i].velocityY)

          if (stamp.posY + newStampSize > canvas.height) {
            stamp.posY = canvas.height - newStampSize;  // スタンプの位置をcanvasの下端に固定

            // 跳ね返る時に摩擦の影響を受ける
            stamp.velocityY = -stamp.velocityY * FRICTION;

            // 速度が非常に小さい場合、ボールを止める

            if (Math.abs(stamp.velocityY) < 0.5) {
              stamp.velocityY = 0;
              stamp.opacity -= 0.1;
              // setTimeout(() => {
              //     stamp.isAnimating = false;
              // }, 1000);

              // 透明度が0になったら、アニメーションを停止
              if (stamp.opacity <= 0) {
                stamp.opacity = 0;
                stamp.isAnimating = false;
              }

            }
          }
          ctx.globalAlpha = stamp.opacity; // 透明度の設定

          // スタンプを描画
          const visibleHeight = stamp.size - (stamp.posY < 0 ? -stamp.posY : 0);  // 画面外にはみ出している部分の高さ
          ctx.drawImage(
            stamp.image,
            0,
            stamp.size - visibleHeight,
            stamp.size, // ソース画像の幅
            visibleHeight, // ソース画像の高さ
            stamp.posX,
            stamp.posY < 0 ? 0 : stamp.posY,
            newStampSize, // 宛先キャンバス上の幅
            newStampSize * (visibleHeight / stamp.size) // 宛先キャンバス上の高さ
          );
          ctx.globalAlpha = 1.0;
        };
      };
      // console.log("テストdrawBarGraph")
      if (stamps.length > 0) {
        requestAnimationFrame(animate);
      }
    };

    //----------------------------------------
    // ▼棒グラフの描画関数
    //----------------------------------------

    let currentAGroupHeight = 0;
    let currentBGroupHeight = 0;
    const lerpRate = 0.05;  // 補完率。0.05のような小さい値でスムーズな変化を得る
    let isFirstDraw = true;

    let imageA = document.createElement('img');
    imageA.src = './img/star_blue.jpg';

    let imageB = document.createElement('img');
    imageB.src = './img/star_red.jpg';
    // console.log(imageA);

    const drawBarGraph = (AGroupPercentage, BGroupPercentage) => {

      // console.log('左下の座標:', bottomLeft);
      // console.log('右下の座標:', bottomRight);

      //----------------------------------------
      // 棒グラフの描画
      //----------------------------------------
      const barWidth = canvas.height / 6;

      const barX1 = canvas.width / 10.2;
      const barX2 = canvas.width - barWidth - barWidth;

      const maxCanvasPercentage = 0.5;  // これはcanvas.heightの50%を意味します。
      const targetAGroupHeight = calculateBarHeight(AGroupPercentage, maxCanvasPercentage, canvas.height);
      const targetBGroupHeight = calculateBarHeight(BGroupPercentage, maxCanvasPercentage, canvas.height);
      // console.log(currentAGroupHeight);

      // 現在の高さを目標の高さに近づける
      if (isFirstDraw) {
        currentAGroupHeight = targetAGroupHeight;
        currentBGroupHeight = targetBGroupHeight;
        isFirstDraw = false;
      } else {
        currentAGroupHeight += (targetAGroupHeight - currentAGroupHeight) * lerpRate;
        currentBGroupHeight += (targetBGroupHeight - currentBGroupHeight) * lerpRate;
      }

      // Aグループのバーグラフのテクスチャを設定
      let patternA = ctx.createPattern(imageA, 'repeat');
      ctx.fillStyle = patternA;
      // ctx.fillStyle = "#0000cc";
      ctx.fillRect(bottomLeftX, bottomLeftY, barWidth, -currentAGroupHeight);
      // console.log(barX1, canvas.height, barWidth, -currentAGroupHeight);

      let patternB = ctx.createPattern(imageB, 'repeat');
      ctx.fillStyle = patternB;
      // ctx.fillStyle = '#cc0000';
      ctx.fillRect(bottomRightX - barWidth, bottomRightY, barWidth, -currentBGroupHeight);

      // // 赤い四角を描く
      // ctx.fillStyle = 'red';
      // ctx.fillRect(canvas.width / 10.2, canvas.height / 15, canvas.width / 1.265, canvas.height / 1.62);
    };

    const calculateBarHeight = (percentage, maxCanvasPercentage, canvasHeight) => {
      return (percentage / 100) * maxCanvasPercentage * canvasHeight;
    }

    //----------------------------------------
    // ▼カウントをゼロにする関数
    //----------------------------------------

    const resetCount = async () => {

      const querySnapshot = await getDocs(q)

      querySnapshot.forEach(async (doc) => {

        // ドキュメントのデータを取得
        const docData = doc.data();

        // カウントを0に設定
        docData.count = 0;

        // ドキュメントを更新
        await updateDoc(doc.ref, docData);

      });
    };

    // ボタンクリック時の処理
    const resetButton = document.getElementById("resetButton");
    resetButton.addEventListener("click", resetCount);

    //----------------------------------------
    // ▼メッセージを出すロジックと関数
    //----------------------------------------

    const displayMessage = (targetPrefix, currentCount) => {
      // メッセージの配列
      const aMessages = [
        `${currentCount}回も送ってくれて、おいさんうれしか⛑！！`,
        `今ので${currentCount}個目ばい⛑!嬉しか！`,
        `おいさー⛑！いい感じ！${currentCount}個目！`,
        `${currentCount}回送ってくれたばい⛑！`,
        "応援ありがとさん⛑⛑！！"
      ];

      const bMessages = [
        `${currentCount}回も送ってくれて、嬉しいです！！`,
        `まいさー！${currentCount}個🥹ありがとう！`,
        `${currentCount}回送ってくれました❣️`,
        "応援ありがとうございます！！"
      ];

      let messages = targetPrefix === 'b' ? aMessages : bMessages;
      // console.log(targetPrefix);

      // 10%の確率でtrueを返す
      const shouldShowMessage = () => Math.random() < 0.3;

      // カウントがメッセージを表示すべきかどうかを判断
      if (shouldShowMessage()) {
        const randomMessage = messages[Math.floor(Math.random() * messages.length)];
        document.getElementById('thanks').innerText = randomMessage;
        // console.log(randomMessage);
        // メッセージ表示の回数を保存
        localStorage.setItem('lastMessageShownCount', currentCount);
        // console.log("currentCount (message shown):", currentCount);
      } else {
        const lastMessageShownCount = parseInt(localStorage.getItem('lastMessageShownCount') || "0");

        // メッセージが表示されてから5回以上クリックされた場合、メッセージを削除
        if (currentCount - lastMessageShownCount > 5) {
          document.getElementById('thanks').innerText = "⛑ご参加ありがとうございます😊";
        }
        // console.log("currentCount:", currentCount);
      }
    }

    //----------------------------------------
    // ▼クリックした画像の表示関数
    //----------------------------------------

    const displayImageInSlot = (id, circleSize) => {
      // 画像のsrcを組み立てる
      const src = `./img/${id}.png`;

      // 最初の空の.image-slotを選択
      const slot = document.querySelector('.image-slot');

      if (slot) {
        // img要素を作成して、src属性を設定
        const img = document.createElement('img');
        img.src = src;
        img.style.width = `${circleSize}px`;    // 画像のサイズを指定
        img.style.height = `${circleSize}px`;   // 画像のサイズを指定
        img.classList.add('fade-in'); // フェードインアニメーションのクラスを追加
        // console.log(img.style.width);

        // 現在の内容 (数字) をクリアして画像を追加
        slot.innerHTML = "";
        slot.appendChild(img);

        // .image-slotクラスを取り除く
        slot.classList.remove("image-slot", "coin-design");
        slot.classList.add("dotted-circle");
      }
    };

    //----------------------------------------
    // ▼ダブルクリックされないようにする関数
    //----------------------------------------

    document.addEventListener('dblclick', function (e) {
      e.preventDefault();
    });

  </script>
</body>

</html>